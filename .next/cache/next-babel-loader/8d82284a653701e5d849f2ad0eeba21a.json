{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { ON_GREEN_COMMENT } from '../../store/actions';\nimport uuid from 'uuid/v1';\nimport { color } from '../../layout/var';\nimport axios from 'axios';\nimport io from 'socket.io-client';\n\nvar CommentList = function CommentList(_ref) {\n  var comment = _ref.comment,\n      perfilImg = _ref.perfilImg,\n      fullName = _ref.fullName;\n  var owner = useSelector(function (state) {\n    return state.user.owner;\n  });\n  return __jsx(\"li\", {\n    className: _JSXStyle.dynamic([[\"814670264\", [owner ? color.prim : \"#bbb\", color.dark, color.light]]]) + \" \" + \"shadow\"\n  }, __jsx(\"div\", {\n    className: _JSXStyle.dynamic([[\"814670264\", [owner ? color.prim : \"#bbb\", color.dark, color.light]]])\n  }, __jsx(\"img\", {\n    src: perfilImg,\n    alt: \"\",\n    className: _JSXStyle.dynamic([[\"814670264\", [owner ? color.prim : \"#bbb\", color.dark, color.light]]])\n  }), __jsx(\"small\", {\n    className: _JSXStyle.dynamic([[\"814670264\", [owner ? color.prim : \"#bbb\", color.dark, color.light]]])\n  }, fullName)), __jsx(\"p\", {\n    className: _JSXStyle.dynamic([[\"814670264\", [owner ? color.prim : \"#bbb\", color.dark, color.light]]])\n  }, comment), __jsx(_JSXStyle, {\n    id: \"814670264\",\n    dynamic: [owner ? color.prim : \"#bbb\", color.dark, color.light]\n  }, [\"li.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:.5rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:#fff;min-width:20%;border-left:5px solid \".concat(owner ? color.prim : \"#bbb\", \";}\"), \"p.__jsx-style-dynamic-selector{margin:0;padding:.3rem;}\", \"div.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:\".concat(color.dark, \";padding:.2rem;}\"), \"small.__jsx-style-dynamic-selector{margin-left:.2rem;color:\".concat(color.light, \";}\"), \"img.__jsx-style-dynamic-selector{width:25px;height:25px;border-radius:50%;object-fit:cover;object-position:center;}\"]));\n};\n\nvar Comment = function Comment() {\n  var dispatch = useDispatch();\n  var comments = useSelector(function (state) {\n    return state.greenpost.current.comments;\n  });\n\n  var _useState = useState(''),\n      value = _useState[0],\n      setValue = _useState[1];\n\n  var _useState2 = useState(false),\n      disable = _useState2[0],\n      setDisable = _useState2[1];\n\n  var input = useRef(null);\n  var scroll = useRef(null);\n  var pid = useSelector(function (state) {\n    return state.greenpost.current._id;\n  });\n  useEffect(function () {\n    var socket = io();\n    socket.open();\n    socket.on(\"green:\".concat(pid), function (newComment) {\n      console.log(newComment);\n      dispatch({\n        type: ON_GREEN_COMMENT,\n        comment: newComment\n      });\n      scroll.current.scrollTo(0, scroll.current.scrollHeight);\n    });\n    return function () {\n      return socket.close();\n    };\n  }, [comments]);\n  useEffect(function () {\n    scroll.current.scrollTo(0, scroll.current.scrollHeight);\n    input.current.focus();\n  }, [comments]);\n\n  var onSubmit =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(e) {\n      var data, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n\n              if (!(e.keyCode === 13 && e.shiftKey === false)) {\n                _context.next = 11;\n                break;\n              }\n\n              e.preventDefault();\n              setDisable(true);\n              data = {\n                comment: value,\n                pid: pid\n              };\n              _context.next = 7;\n              return axios.post('/green/comment/add', data);\n\n            case 7:\n              res = _context.sent;\n              setDisable(false);\n              setValue('');\n              input.current.focus();\n\n            case 11:\n              _context.next = 16;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 13]]);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: _JSXStyle.dynamic([[\"2967572591\", [color.prim, color.sec, color.light, color.light, color.sec]]]) + \" \" + \"main_cont animated fadeIn\"\n  }, __jsx(\"ul\", {\n    ref: scroll,\n    className: _JSXStyle.dynamic([[\"2967572591\", [color.prim, color.sec, color.light, color.light, color.sec]]])\n  }, comments.map(function (comment) {\n    return __jsx(CommentList, _extends({}, comment, {\n      key: uuid()\n    }));\n  })), __jsx(\"form\", {\n    onSubmit: onSubmit,\n    className: _JSXStyle.dynamic([[\"2967572591\", [color.prim, color.sec, color.light, color.light, color.sec]]])\n  }, __jsx(\"textarea\", {\n    disabled: disable,\n    onKeyDown: onSubmit,\n    ref: input,\n    value: value,\n    onChange: function onChange(e) {\n      return setValue(e.currentTarget.value);\n    },\n    name: \"\",\n    id: \"\",\n    className: _JSXStyle.dynamic([[\"2967572591\", [color.prim, color.sec, color.light, color.light, color.sec]]])\n  })), __jsx(_JSXStyle, {\n    id: \"2967572591\",\n    dynamic: [color.prim, color.sec, color.light, color.light, color.sec]\n  }, [\".main_cont.__jsx-style-dynamic-selector{height:100%;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\", \"ul.__jsx-style-dynamic-selector{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;list-style:none;margin:0;padding:0;width:100%;height:100%;overflow-y:scroll;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:45px 20px 0px;}\", \"ul.__jsx-style-dynamic-selector::-webkit-scrollbar{width:0;}\", \"form.__jsx-style-dynamic-selector{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background:\".concat(color.prim, \";padding:.5rem;}\"), \"textarea.__jsx-style-dynamic-selector{resize:none;border-radius:2px;border:1px solid \".concat(color.sec, \";}\"), \"button.__jsx-style-dynamic-selector{margin-top:.5rem;-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;background:transparent;border:2px solid \".concat(color.light, \";color:\").concat(color.light, \";-webkit-transition:250ms ease;transition:250ms ease;}\"), \"button.__jsx-style-dynamic-selector:focus{outline:none;}\", \"button.__jsx-style-dynamic-selector:hover{background:\".concat(color.sec, \";}\")]));\n};\n\nexport default Comment;","map":null,"metadata":{},"sourceType":"module"}