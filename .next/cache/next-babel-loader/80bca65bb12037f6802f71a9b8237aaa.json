{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { ON_CHAT_CLOSE, ON_CHAT_MINIMIZE, ON_CHAT_MSG, ON_CHAT_ALERT } from '../../store/actions';\nimport uuid from 'uuid/v1';\nimport persons from '../../test/persons';\nimport { color } from '../../layout/var';\nimport axios from 'axios';\nimport io from 'socket.io-client';\n\nconst Chat = ({\n  fullName,\n  perfilImg,\n  _id,\n  minimize,\n  chatHistory,\n  privates,\n  anAlert\n}) => {\n  const dispatch = useDispatch();\n  const cuid = useSelector(state => state.nav.notifications.id);\n  const {\n    0: msg,\n    1: setMsg\n  } = useState([]);\n  const inputRef = useRef(null);\n  const chatRef = useRef(null);\n  const current = useSelector(state => state.chat.current);\n  const {\n    0: chat,\n    1: setChat\n  } = useState([]);\n\n  const onChat = async () => {\n    try {\n      const res = await axios.get(`/chat/private/${_id}`);\n      setChat(res.data);\n      chatRef.current.scrollTo(0, chatRef.current.scrollHeight);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  useEffect(() => {\n    chatRef.current.scrollTo(0, chatRef.current.scrollHeight);\n    inputRef.current.focus();\n  }, [chat]);\n  useEffect(() => {\n    const socket = io();\n    onChat();\n\n    try {\n      socket.open();\n      socket.on(`private:${cuid}`, payload => {\n        setChat([...chat, payload.msg]);\n      });\n    } catch (e) {\n      console.log(e);\n    }\n\n    console.log('hola');\n    return () => {\n      socket.close();\n    };\n  }, []);\n\n  const onMinimize = () => {\n    const isMin = privates.find(user => user._id === _id);\n\n    if (isMin.minimize) {\n      dispatch({\n        type: ON_CHAT_MINIMIZE,\n        _id,\n        option: false\n      });\n      dispatch({\n        type: ON_CHAT_ALERT,\n        _id,\n        option: false\n      });\n    } else {\n      dispatch({\n        type: ON_CHAT_MINIMIZE,\n        _id,\n        option: true\n      });\n    }\n  };\n\n  const onSubmit = async e => {\n    try {\n      if (e.keyCode === 13 && !e.shiftKey || e.type === \"submit\") {\n        e.preventDefault();\n        const newMsg = {\n          id: cuid,\n          pm: msg\n        };\n        const data = {\n          tid: _id,\n          msg: newMsg\n        };\n        setMsg('');\n        setChat([...chat, newMsg]);\n        await axios.post('/chat/send', data);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return __jsx(\"li\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"main shadow\"\n  }, __jsx(\"header\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, __jsx(\"button\", {\n    onClick: onMinimize,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"name\"\n  }, __jsx(\"img\", {\n    src: perfilImg,\n    alt: \"\",\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }), fullName), __jsx(\"button\", {\n    onClick: () => dispatch({\n      type: ON_CHAT_CLOSE,\n      _id\n    }),\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, \"X\")), __jsx(\"ul\", {\n    ref: chatRef,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"body\"\n  }, chat.map(msg => __jsx(\"li\", {\n    key: uuid(),\n    style: {\n      alignSelf: cuid === msg.id ? 'flex-end' : 'flex-start'\n    },\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, cuid !== msg.id && __jsx(\"img\", {\n    src: perfilImg,\n    alt: \"\",\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }), __jsx(\"p\", {\n    style: {\n      background: cuid === msg.id ? color.prim : 'rgba(0, 0, 0, .050)',\n      color: cuid === msg.id ? color.light : color.dark\n    },\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, msg.pm)))), __jsx(\"form\", {\n    onSubmit: onSubmit,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, __jsx(\"textarea\", {\n    id: _id,\n    value: msg,\n    onChange: e => setMsg(e.currentTarget.value),\n    onKeyDown: onSubmit,\n    ref: inputRef,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  })), __jsx(\"footer\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }), __jsx(_JSXStyle, {\n    id: \"1622551285\",\n    dynamic: [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]\n  }, [`li.main.__jsx-style-dynamic-selector{width:25%;border:1px solid ${color.sec};position:relative;top:${minimize ? '-43px' : '-343px'};margin-right:1rem;border-radius:3px 3px 0 0;}`, `header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:${anAlert ? color.danger : color.prim};}`, \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector{-webkit-transition:250ms ease;transition:250ms ease;border:none;font-size:1rem;color:rgba(255,255,255,.7);text-transform:capitalize;background:transparent;}\", \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector:focus{outline:none;}\", \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector:hover{color:#fff;}\", \".name.__jsx-style-dynamic-selector{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;text-align:left;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:550;}\", \".name.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:40px;height:40px;object-fit:cover;object-position:center;border-radius:50%;margin-right:.3rem;}\", \"ul.__jsx-style-dynamic-selector{list-style:none;marign:0;padding:0;height:250px;overflow-y:scroll;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background:#fff;}\", \"ul.__jsx-style-dynamic-selector::-webkit-scrollbar{width:0;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector{margin:.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:25px;height:25px;object-fit:cover;object-position:center;border-radius:50%;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector p.__jsx-style-dynamic-selector{margin:0;background:rgba(0,0,0,.050);padding:.1rem .2rem;margin-left:.5rem;border-radius:3px;border:1px solid rgba(0,0,0,.080);}\", \"form.__jsx-style-dynamic-selector{width:30px;width:100%;margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}\", \"form.__jsx-style-dynamic-selector textarea.__jsx-style-dynamic-selector{resize:none;width:100%;height:100%;margin:0;font-size:11px;}\", `footer.__jsx-style-dynamic-selector{height:10px;background:${color.prim};}`]));\n};\n\nconst Private = () => {\n  const {\n    0: chats,\n    1: setChats\n  } = useState([]);\n  const privates = useSelector(state => state.chat.privates);\n  useEffect(() => {\n    setChats(privates);\n  }, [privates.length]);\n  return __jsx(\"div\", {\n    className: \"jsx-60269558\"\n  }, __jsx(\"ul\", {\n    className: \"jsx-60269558\"\n  }, privates.map(chat => __jsx(Chat, _extends({\n    key: uuid()\n  }, chat, {\n    privates: privates\n  })))), __jsx(_JSXStyle, {\n    id: \"60269558\"\n  }, [\"ul.jsx-60269558{list-style:none;margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}\"]));\n};\n\nexport default Private;","map":null,"metadata":{},"sourceType":"module"}