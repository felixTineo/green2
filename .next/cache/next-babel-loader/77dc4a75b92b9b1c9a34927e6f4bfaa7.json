{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { ON_CHAT_CLOSE, ON_CHAT_MINIMIZE, ON_CHAT_MSG, ON_CHAT_ALERT } from '../../store/actions';\nimport uuid from 'uuid/v1';\nimport persons from '../../test/persons';\nimport { color } from '../../layout/var';\nimport axios from 'axios';\nimport io from 'socket.io-client';\n\nvar Chat = function Chat(_ref) {\n  var fullName = _ref.fullName,\n      perfilImg = _ref.perfilImg,\n      _id = _ref._id,\n      minimize = _ref.minimize,\n      chatHistory = _ref.chatHistory,\n      privates = _ref.privates,\n      anAlert = _ref.anAlert;\n  var dispatch = useDispatch();\n  var cuid = useSelector(function (state) {\n    return state.nav.notifications.id;\n  });\n\n  var _useState = useState([]),\n      msg = _useState[0],\n      setMsg = _useState[1];\n\n  var inputRef = useRef(null);\n  var chatRef = useRef(null);\n  var current = useSelector(function (state) {\n    return state.chat.current;\n  });\n\n  var _useState2 = useState([]),\n      chat = _useState2[0],\n      setChat = _useState2[1];\n\n  var onChat =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.get(\"/chat/private/\".concat(_id));\n\n            case 3:\n              res = _context.sent;\n              setChat(res.data);\n              chatRef.current.scrollTo(0, chatRef.current.scrollHeight);\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 8]]);\n    }));\n\n    return function onChat() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    onChat();\n  }, []);\n  useEffect(function () {\n    chatRef.current.scrollTo(0, chatRef.current.scrollHeight);\n    inputRef.current.focus();\n  }, [chat]);\n  useEffect(function () {\n    var socket = io();\n\n    try {\n      socket.open();\n      socket.on(\"private:\".concat(cuid), function (payload) {\n        setChat([].concat(_toConsumableArray(chat), [payload.msg]));\n        chatRef.current.scrollTo(0, chatRef.current.scrollHeight);\n        inputRef.current.focus();\n      });\n    } catch (e) {\n      console.log(e);\n    }\n\n    return function () {\n      return socket.close();\n    };\n  }, [chat]);\n\n  var onMinimize = function onMinimize() {\n    var isMin = privates.find(function (user) {\n      return user._id === _id;\n    });\n\n    if (isMin.minimize) {\n      dispatch({\n        type: ON_CHAT_MINIMIZE,\n        _id: _id,\n        option: false\n      });\n      dispatch({\n        type: ON_CHAT_ALERT,\n        _id: _id,\n        option: false\n      });\n    } else {\n      dispatch({\n        type: ON_CHAT_MINIMIZE,\n        _id: _id,\n        option: true\n      });\n    }\n  };\n\n  var onSubmit =\n  /*#__PURE__*/\n  function () {\n    var _ref3 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(e) {\n      var newMsg, data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (!(e.keyCode === 13 && !e.shiftKey || e.type === \"submit\")) {\n                _context2.next = 9;\n                break;\n              }\n\n              e.preventDefault();\n              newMsg = {\n                id: cuid,\n                pm: msg\n              };\n              data = {\n                tid: _id,\n                msg: newMsg\n              };\n              setMsg('');\n              setChat([].concat(_toConsumableArray(chat), [newMsg]));\n              _context2.next = 9;\n              return axios.post('/chat/send', data);\n\n            case 9:\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"li\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"main shadow\"\n  }, console.log(chat), __jsx(\"header\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, __jsx(\"button\", {\n    onClick: onMinimize,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"name\"\n  }, __jsx(\"img\", {\n    src: perfilImg,\n    alt: \"\",\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }), fullName), __jsx(\"button\", {\n    onClick: function onClick() {\n      return dispatch({\n        type: ON_CHAT_CLOSE,\n        _id: _id\n      });\n    },\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, \"X\")), __jsx(\"ul\", {\n    ref: chatRef,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]]) + \" \" + \"body\"\n  }, chat.map(function (msg) {\n    return __jsx(\"li\", {\n      key: uuid(),\n      style: {\n        alignSelf: cuid === msg.id ? 'flex-end' : 'flex-start'\n      },\n      className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n    }, cuid !== msg.id && __jsx(\"img\", {\n      src: perfilImg,\n      alt: \"\",\n      className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n    }), __jsx(\"p\", {\n      style: {\n        background: cuid === msg.id ? color.prim : 'rgba(0, 0, 0, .050)',\n        color: cuid === msg.id ? color.light : color.dark\n      },\n      className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n    }, msg.pm));\n  })), __jsx(\"form\", {\n    onSubmit: onSubmit,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }, __jsx(\"textarea\", {\n    id: _id,\n    value: msg,\n    onChange: function onChange(e) {\n      return setMsg(e.currentTarget.value);\n    },\n    onKeyDown: onSubmit,\n    ref: inputRef,\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  })), __jsx(\"footer\", {\n    className: _JSXStyle.dynamic([[\"1622551285\", [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]]])\n  }), __jsx(_JSXStyle, {\n    id: \"1622551285\",\n    dynamic: [color.sec, minimize ? '-43px' : '-343px', anAlert ? color.danger : color.prim, color.prim]\n  }, [\"li.main.__jsx-style-dynamic-selector{width:25%;border:1px solid \".concat(color.sec, \";position:relative;top:\").concat(minimize ? '-43px' : '-343px', \";margin-right:1rem;border-radius:3px 3px 0 0;}\"), \"header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:\".concat(anAlert ? color.danger : color.prim, \";}\"), \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector{-webkit-transition:250ms ease;transition:250ms ease;border:none;font-size:1rem;color:rgba(255,255,255,.7);text-transform:capitalize;background:transparent;}\", \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector:focus{outline:none;}\", \"header.__jsx-style-dynamic-selector button.__jsx-style-dynamic-selector:hover{color:#fff;}\", \".name.__jsx-style-dynamic-selector{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;text-align:left;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:550;}\", \".name.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:40px;height:40px;object-fit:cover;object-position:center;border-radius:50%;margin-right:.3rem;}\", \"ul.__jsx-style-dynamic-selector{list-style:none;marign:0;padding:0;height:250px;overflow-y:scroll;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background:#fff;}\", \"ul.__jsx-style-dynamic-selector::-webkit-scrollbar{width:0;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector{margin:.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:25px;height:25px;object-fit:cover;object-position:center;border-radius:50%;}\", \"ul.__jsx-style-dynamic-selector li.__jsx-style-dynamic-selector p.__jsx-style-dynamic-selector{margin:0;background:rgba(0,0,0,.050);padding:.1rem .2rem;margin-left:.5rem;border-radius:3px;border:1px solid rgba(0,0,0,.080);}\", \"form.__jsx-style-dynamic-selector{width:30px;width:100%;margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}\", \"form.__jsx-style-dynamic-selector textarea.__jsx-style-dynamic-selector{resize:none;width:100%;height:100%;margin:0;font-size:11px;}\", \"footer.__jsx-style-dynamic-selector{height:10px;background:\".concat(color.prim, \";}\")]));\n};\n\nvar Private = function Private() {\n  var _useState3 = useState([]),\n      chats = _useState3[0],\n      setChats = _useState3[1];\n\n  var privates = useSelector(function (state) {\n    return state.chat.privates;\n  });\n  useEffect(function () {\n    setChats(privates);\n  }, [privates.length]);\n  return __jsx(\"div\", {\n    className: \"jsx-60269558\"\n  }, __jsx(\"ul\", {\n    className: \"jsx-60269558\"\n  }, privates.map(function (chat) {\n    return __jsx(Chat, _extends({\n      key: uuid()\n    }, chat, {\n      privates: privates\n    }));\n  })), __jsx(_JSXStyle, {\n    id: \"60269558\"\n  }, [\"ul.jsx-60269558{list-style:none;margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}\"]));\n};\n\nexport default Private;","map":null,"metadata":{},"sourceType":"module"}