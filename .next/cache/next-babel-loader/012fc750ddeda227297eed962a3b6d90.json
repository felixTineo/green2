{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useCallback, useState } from 'react';\nimport Logo from './logo';\nimport Router from 'next/router';\nimport './header.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSearch, faGift, faHeart, faUser, faCog, faCoins, faBell } from '@fortawesome/free-solid-svg-icons';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { navView, ON_VIEW_NAV, ON_LOADER, ON_NOTIFICATIONS, ON_LOGIN } from '../../store/actions';\nimport axios from 'axios';\nimport Link from 'next/link';\nimport { Popover, PopoverBody } from 'reactstrap';\nimport uuid from 'uuid/v1';\nimport io from 'socket.io-client';\n\nvar DownBar = function DownBar() {\n  var _useState = useState(false),\n      down = _useState[0],\n      setDown = _useState[1];\n\n  useEffect(function () {\n    window.onscroll = function () {\n      if (window.scrollY > 30) {\n        setDown(true);\n      } else {\n        setDown(false);\n      }\n    };\n  }, []);\n\n  var _useState2 = useState(false),\n      sm = _useState2[0],\n      setSm = _useState2[1];\n\n  useEffect(function () {\n    if (window.innerWidth < 576) {\n      setSm(true);\n    }\n  }, []);\n  return __jsx(\"div\", {\n    className: \"down_bar\",\n    style: {\n      height: down || sm ? 40 : 0\n    }\n  });\n};\n\nvar SearchBar = function SearchBar() {\n  var testList = [\"felix\", \"luis\", \"maximiliano\", \"francisco\", 'teresa', 'yleana'];\n\n  var _useState3 = useState([]),\n      suggest = _useState3[0],\n      setSuggest = _useState3[1];\n\n  var onSuggest = function onSuggest(e) {\n    var value = e.target.value;\n\n    if (value) {\n      value.toLocaleLowerCase();\n\n      var _suggest = testList.filter(function (name) {\n        return name.toLocaleLowerCase().indexOf(value) > -1;\n      });\n\n      setSuggest(_suggest);\n    } else {\n      setSuggest([]);\n    }\n  };\n\n  return __jsx(\"div\", {\n    className: \"searchbar_main_cont\"\n  }, __jsx(\"div\", {\n    className: \"search_cont\"\n  }, __jsx(\"input\", {\n    onChange: onSuggest,\n    type: \"text\"\n  }), __jsx(\"p\", null, __jsx(FontAwesomeIcon, {\n    icon: faSearch\n  }))), __jsx(\"ul\", {\n    style: {\n      padding: suggest.length > 0 ? '.2rem' : '0'\n    },\n    className: \"sugesstlist\"\n  }, suggest.map(function (item) {\n    return __jsx(\"li\", null, item);\n  })));\n};\n\nvar Gift = function Gift() {\n  var gifts = useSelector(function (state) {\n    return state.nav.notifications.gifts;\n  });\n  var dispatch = useDispatch();\n  var onView = useCallback(function () {\n    dispatch({\n      type: ON_VIEW_NAV,\n      note: navView.GIFT\n    });\n  });\n  return __jsx(\"div\", {\n    className: \"btnicon_cont\"\n  }, __jsx(\"button\", {\n    id: \"gift\",\n    onClick: onView,\n    style: gifts.view && gifts.length > 0 ? {\n      background: \"#fff\",\n      color: \"#ff6c1a\"\n    } : {\n      background: \"transparent\",\n      color: \"#fff\"\n    },\n    className: \"btnicon_nav\"\n  }, __jsx(FontAwesomeIcon, {\n    icon: faGift\n  })), __jsx(\"span\", {\n    style: gifts.view && gifts.length > 0 ? {\n      color: \"#ff6c1a\"\n    } : {\n      color: \"#fff\"\n    }\n  }, \"+\", gifts.items.length));\n};\n\nvar Note = function Note() {\n  var notes = useSelector(function (state) {\n    return state.nav.notifications.notes;\n  });\n  var dispatch = useDispatch();\n  var onView = useCallback(function () {\n    dispatch({\n      type: ON_VIEW_NAV,\n      note: navView.NOTES\n    });\n  });\n\n  var _useState4 = useState(false),\n      pop = _useState4[0],\n      setPop = _useState4[1];\n\n  var handleView = function handleView() {\n    onView();\n    setPop(!pop);\n  };\n\n  var handleViewOut = function handleViewOut() {\n    setPop(false);\n  };\n\n  return __jsx(\"div\", {\n    className: \"btnicon_cont\"\n  }, __jsx(\"button\", {\n    id: \"note\",\n    onClick: handleView,\n    style: notes.view && notes.length > 0 ? {\n      background: \"#fff\",\n      color: \"#ff6c1a\"\n    } : {\n      background: \"transparent\",\n      color: \"#fff\"\n    },\n    className: \"btnicon_nav\"\n  }, __jsx(FontAwesomeIcon, {\n    icon: faBell\n  })), __jsx(\"span\", {\n    style: notes.view && notes.length > 0 ? {\n      color: \"#ff6c1a\"\n    } : {\n      color: \"#fff\"\n    }\n  }, \"+\", notes.items.length), __jsx(Popover, {\n    target: \"note\",\n    isOpen: pop,\n    placement: \"bottom\"\n  }, __jsx(PopoverBody, null, __jsx(\"ul\", {\n    onClick: handleViewOut\n  }, notes.items.map(function (item) {\n    return __jsx(\"li\", {\n      key: uuid()\n    }, item.id);\n  })))));\n};\n\nvar Friend = function Friend() {\n  var friend = useSelector(function (state) {\n    return state.nav.notifications.friendReq;\n  });\n  var dispatch = useDispatch();\n  var onView = useCallback(function () {\n    dispatch({\n      type: ON_VIEW_NAV,\n      note: navView.FRIEND\n    });\n  });\n  /*  const [list, setList] = useState([]);\n    useEffect(()=> {\n      setList(friend.items);\n    },[friend.items]);*/\n\n  var _useState5 = useState(false),\n      pop = _useState5[0],\n      setPop = _useState5[1];\n\n  var handleView = function handleView() {\n    onView();\n    setPop(!pop);\n  };\n\n  var handleViewOut = function handleViewOut() {\n    setPop(false);\n  };\n\n  return __jsx(\"div\", {\n    className: \"btnicon_cont\"\n  }, __jsx(\"button\", {\n    id: \"friend\",\n    onClick: handleView,\n    style: friend.view && friend.length > 0 ? {\n      background: \"#fff\",\n      color: \"#ff6c1a\"\n    } : {\n      background: \"transparent\",\n      color: \"#fff\"\n    },\n    className: \"btnicon_nav\"\n  }, __jsx(FontAwesomeIcon, {\n    icon: faUser\n  })), __jsx(\"span\", {\n    style: friend.view && friend.length > 0 ? {\n      color: \"#ff6c1a\"\n    } : {\n      color: \"#fff\"\n    }\n  }, \"+\", friend.items.length), __jsx(Popover, {\n    target: \"friend\",\n    isOpen: pop,\n    placement: \"bottom\"\n  }, __jsx(PopoverBody, null, __jsx(\"ul\", {\n    onMouseLeave: handleViewOut\n  }, friend.items.map(function (item) {\n    return __jsx(\"li\", {\n      key: uuid()\n    }, item.name);\n  })))));\n};\n\nvar Option = function Option() {\n  var _useState6 = useState(false),\n      pop = _useState6[0],\n      setPop = _useState6[1];\n\n  var dispatch = useDispatch();\n  var onLogout = useCallback(\n  /*#__PURE__*/\n  _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return axios.get('/user/logout');\n\n          case 3:\n            dispatch({\n              type: ON_LOGIN,\n              option: false\n            });\n            window.location = '/';\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 7]]);\n  })));\n  return __jsx(\"div\", {\n    className: \"btnicon_cont\"\n  }, __jsx(\"button\", {\n    id: \"option\",\n    onClick: function onClick() {\n      return setPop(!pop);\n    },\n    className: \"btnicon_nav\"\n  }, __jsx(FontAwesomeIcon, {\n    icon: faCog\n  })), __jsx(Popover, {\n    target: \"option\",\n    isOpen: pop,\n    placement: \"bottom\"\n  }, __jsx(PopoverBody, {\n    style: {\n      padding: 0\n    }\n  }, __jsx(\"ul\", {\n    className: \"option_list\",\n    onMouseLeave: function onMouseLeave() {\n      return setPop(false);\n    }\n  }, __jsx(\"li\", null, __jsx(\"button\", null, \"perfil\")), __jsx(\"li\", null, __jsx(\"button\", {\n    onClick: onLogout\n  }, \"salir\"))))));\n};\n\nvar Wallet = function Wallet() {\n  var wallet = useSelector(function (state) {\n    return state.nav.wallet;\n  });\n  return __jsx(\"div\", {\n    className: \"btnicon_cont\"\n  }, __jsx(\"p\", {\n    className: \"wallet_cont\"\n  }, __jsx(FontAwesomeIcon, {\n    icon: faCoins\n  })), __jsx(\"span\", {\n    style: {\n      fontSize: 16\n    }\n  }, \"+\", wallet));\n};\n\nvar Notifications = function Notifications() {\n  return __jsx(\"ul\", {\n    className: \"notifications_main_cont\"\n  }, __jsx(\"li\", null, __jsx(Gift, null)), __jsx(\"li\", null, __jsx(Note, null)), __jsx(\"li\", null, __jsx(Friend, null)), __jsx(\"li\", null, __jsx(Option, null)), __jsx(\"li\", null, __jsx(Wallet, null)));\n};\n\nvar BarLoader = function BarLoader() {\n  var loader = useSelector(function (state) {\n    return state.nav.loader;\n  });\n  var dispatch = useDispatch();\n  var onLoader = useCallback(function (loader) {\n    return dispatch({\n      type: ON_LOADER,\n      loader: loader\n    });\n  });\n  return __jsx(\"div\", {\n    className: \"barloader\",\n    style: {\n      width: \"\".concat(loader, \"%\")\n    }\n  });\n};\n\nvar Header = function Header() {\n  var nav = useSelector(function (state) {\n    return state.nav;\n  });\n\n  var _useState7 = useState(0),\n      width = _useState7[0],\n      setWidth = _useState7[1];\n\n  var dispatch = useDispatch();\n\n  var onNotifications =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (!nav.login) {\n                _context2.next = 6;\n                break;\n              }\n\n              _context2.next = 4;\n              return axios.get(\"/user/notifications\");\n\n            case 4:\n              res = _context2.sent;\n              dispatch({\n                type: ON_NOTIFICATIONS,\n                notifications: res.data\n              });\n\n            case 6:\n              _context2.next = 11;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 8]]);\n    }));\n\n    return function onNotifications() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var socket = io();\n    socket.open();\n    socket.on(\"nav:\".concat(nav.notifications.id), function (payload) {\n      var items = nav.notifications[payload.note].items;\n      console.log(items);\n      items = [payload.user].concat(_toConsumableArray(nav.notifications[payload.note].items));\n      console.log(items);\n      var reduxPayload = {\n        note: payload.action,\n        items: items\n      };\n      dispatch({\n        type: 'ON_NOTE',\n        payload: reduxPayload\n      });\n    });\n    return function () {\n      return socket.close();\n    };\n  }, [nav.notifications]);\n  useEffect(function () {\n    onNotifications();\n  }, [nav.login]);\n  useEffect(function () {\n    setWidth(window.innerWidth);\n  }, []);\n  return __jsx(\"header\", {\n    className: \"header_main_cont\"\n  }, __jsx(BarLoader, null), __jsx(\"nav\", null, __jsx(DownBar, null), __jsx(\"div\", {\n    className: \"logo_search\"\n  }, __jsx(Logo, {\n    url: \"/\"\n  }), nav.login && width > 992 && __jsx(SearchBar, null)), !nav.login && __jsx(Link, {\n    href: \"/login\"\n  }, __jsx(\"button\", {\n    className: \"btn_login\"\n  }, \"login\")), nav.login && __jsx(Notifications, null)), width < 576 && nav.login && __jsx(SearchBar, null));\n};\n\nexport default Header;","map":null,"metadata":{},"sourceType":"module"}